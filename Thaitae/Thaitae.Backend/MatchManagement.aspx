<%@ Page Title="" Language="C#" MasterPageFile="~/Backend.Master" AutoEventWireup="true"
    CodeBehind="MatchManagement.aspx.cs" Inherits="Thaitae.Backend.MatchManagement" %>

<%@ Register Assembly="Trirand.Web" Namespace="Trirand.Web.UI.WebControls" TagPrefix="cc1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <script type="text/javascript">
        function bindCalendarDialog() {
            $('input[id][name$="MatchDate"]').datetimepicker();
        }
        function showSubGrids(subgrid_id, row_id) {
            // the "showSubGrid_JQGrid2" function is autogenerated and available globally on the page by the second child grid.
            // Calling it will place the child grid below the parent expanded row and will call the OnDataRequesting event
            // of the child grid, with ID equal to the ID of the parent expanded row
            showSubGrid_JqgridHomeTeam(subgrid_id, row_id, "<b>Team Home</b>", "JqgridHomeTeam");
            showSubGrid_JqgridAwayTeam(subgrid_id, row_id, "<b>Team Away</b>", "JqgridAwayTeam");
        }

        $(document).ready(function () {
            $("#<%=JqgridHomeTeam.ClientID%>").css("float", "left");
            $("#<%=JqgridAwayTeam.ClientID%>").css("float", "right");
        });
    </script>
</asp:Content>
<asp:content id="Content2" contentplaceholderid="ContentPlaceHolder1" runat="server">
    <h2>
        Match Management</h2>
    <asp:updatepanel id="updateTeamPanel" updatemode="Conditional" runat="server">
        <contenttemplate>
            <asp:DropDownList runat="server" ID="ddlLeague" DataSourceID="LeagueDataSource" DataTextField="LeagueName"
                DataValueField="LeagueId" AutoPostBack="True" OnSelectedIndexChanged="ddlLeague_SelectedIndexChanged">
            </asp:DropDownList>
            <asp:DropDownList runat="server" ID="ddlSeason" DataSourceID="SeasonDataSource" DataTextField="SeasonName"
                DataValueField="SeasonId" AutoPostBack="True" OnSelectedIndexChanged="ddlSeason_SelectedIndexChanged">
            </asp:DropDownList>
            <asp:Button ID="GenMatch" ClientIDMode="Static" runat="server" onclick="Button1_Click" Text="Generate Match"></asp:Button>
            <asp:DropDownList runat="server" ID="ddlTeam" DataSourceID="TeamDataSource" DataTextField="TeamName"
                DataValueField="TeamId" AutoPostBack="True">
            </asp:DropDownList>
            <cc1:JQGrid ID="JqgridMatch1" runat="server" AutoWidth="True" OnRowAdding="JqgridMatch1_RowAdding"
                OnRowDeleting="JqgridMatch1_RowDeleting" OnRowEditing="JqgridMatch1_RowEditing" Height="100%">
                <Columns>
                    <cc1:JQGridColumn DataField="MatchId" PrimaryKey="True" Visible="False"/>
                    <cc1:JQGridColumn DataField="SeasonId" Visible="False" />
                    <cc1:JQGridColumn HeaderText="Edit Actions" EditActionIconsColumn="true" Width="50"
                        TextAlign="Center" />
                    <cc1:JQGridColumn HeaderText="Home Team" DataType="String" DataField="TeamHomeIdName"
                        EditType="DropDown" EditorControlID="ddlTeam" Editable="True" TextAlign="Center" />
                    <cc1:JQGridColumn HeaderText="Away Team" DataType="String" DataField="TeamAwayIdName"
                        EditType="DropDown" EditorControlID="ddlTeam" Editable="True" TextAlign="Center" />
                    <cc1:JQGridColumn HeaderText="Match Date" DataType="DateTime" DataFormatString="{0:dd/MM/yyyy HH:mm}"
                        DataField="MatchDate" EditType="TextBox" Editable="True" TextAlign="Center" />
                </Columns>
                <AddDialogSettings CloseAfterAdding="True" />
                <EditDialogSettings CloseAfterEditing="True" />
                <ToolBarSettings ShowEditButton="True" ShowDeleteButton="true" ShowAddButton="True"
                    ShowRefreshButton="True" ShowSearchButton="True" />
                <AppearanceSettings ShowRowNumbers="true" />
                <ClientSideEvents AfterAddDialogShown="bindCalendarDialog" RowSelect="bindCalendarDialog" SubGridRowExpanded="showSubGrids"/>
                <HierarchySettings HierarchyMode="Parent"  />
            </cc1:JQGrid>
            <div style="float:left">
            <cc1:JQGrid ID="JqgridHomeTeam" runat="server" OnDataRequesting="JqgridHomeTeam_DataRequesting">
                <Columns>
                    <cc1:JQGridColumn DataField="TeamMatchId" PrimaryKey="True" Visible="False" DataType="Int" />
                    <cc1:JQGridColumn HeaderText="Team Goal" DataField="TeamGoalFor" DataType="Int" Editable="True" TextAlign="Center" />
                    <cc1:JQGridColumn HeaderText="Team Yellow Card" DataField="TeamYellowCard" DataType="Int" Editable="True" TextAlign="Center"/>
                    <cc1:JQGridColumn HeaderText="Team Red Card" DataField="TeamRedCard" DataType="Int" Editable="True" TextAlign="Center" />
                </Columns>
                <HierarchySettings HierarchyMode="Child" />
            </cc1:JQGrid>
            </div>
            <cc1:JQGrid ID="JqgridAwayTeam" runat="server" OnDataRequesting="JqgridAwayTeam_DataRequesting">
                <Columns>
                    <cc1:JQGridColumn DataField="TeamMatchId" PrimaryKey="True" Visible="False" DataType="Int" />
                    <cc1:JQGridColumn HeaderText="Team Goal" DataField="TeamGoalFor" DataType="Int" Editable="True" TextAlign="Center" />
                    <cc1:JQGridColumn HeaderText="Team Yellow Card" DataField="TeamYellowCard" DataType="Int" Editable="True" TextAlign="Center"/>
                    <cc1:JQGridColumn HeaderText="Team Red Card" DataField="TeamRedCard" DataType="Int" Editable="True" TextAlign="Center" />
                </Columns>
                <HierarchySettings HierarchyMode="Child" />
            </cc1:JQGrid>
        </contenttemplate>
    </asp:updatepanel>
    <asp:objectdatasource id="LeagueDataSource" dataobjecttypename="thaitae.lib.League"
        selectmethod="SelectLeagueItems" typename="thaitae.lib.Page.LeagueHelper" runat="server">
    </asp:objectdatasource>
    <asp:objectdatasource id="TeamDataSource" dataobjecttypename="" selectmethod="ListTeamItems"
        typename="thaitae.lib.Page.TeamHelper" runat="server">
        <selectparameters>
            <asp:SessionParameter Name="SeasonId" SessionField="SeasonId" Type="Int32" />
        </selectparameters>
    </asp:objectdatasource>
    <asp:objectdatasource id="SeasonDataSource" dataobjecttypename="thaitae.lib.Season"
        selectmethod="ListSeasonItems" typename="thaitae.lib.Page.SeasonHelper" runat="server">
        <selectparameters>
            <asp:SessionParameter Name="LeagueId" SessionField="LeagueId" Type="Int32" />
        </selectparameters>
    </asp:objectdatasource>
</asp:content>